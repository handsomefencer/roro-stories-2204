commands:
    restore-and-save-cache:
        steps:
            - restore_cache:
                key: circlev2-{{ checksum "Gemfile.lock" }}
            - run: bundle config set --local path 'vendor/bundle'
            - run: bundle check || bundle install --jobs=4 --retry=3
            - run: gem build roro.gemspec
            - run: gem install roro-0.3.30.gem
            - save_cache:
                key: circlev2-{{ checksum "Gemfile.lock" }}
                paths:
                    - vendor/bundle
    run-test-case:
        parameters:
            answers:
                default: 1\n1
                type: string
            os:
                type: executor
        steps:
            - run: |
                rake install &&
                printf "<< parameters.answers >>\na$var\n" | roro rollon
            - run: echo 'success'
executors:
    linux:
        docker:
            - image: cimg/ruby:2.7
    mac:
        macos:
            xcode: 11.4
    ruby:
        docker:
            - image: cimg/ruby:<<parameters.version>>
        parameters:
            version:
                default: "2.5"
                description: version tag
                type: string
    ruby-executor:
        docker:
            - image: cimg/ruby:2.7
jobs:
    build:
        executor:
            name: ruby
        steps:
            - checkout
            - run: whoami
    release:
        executor:
            name: ruby
        steps:
            - checkout
            - run: |
                git config --global user.email "fred.schoeneman@gmail.com"
                git config --global user.name "Fred Schoeneman"
            - run: gem install gem-release
            - run: gem bump
            - run: gem release
    test-rollon:
        executor: << parameters.os >>
        parameters:
            answers:
                default: 1\1
                type: string
            os:
                default: linux
                type: executor
        steps:
            - checkout
            - setup_remote_docker:
                version: 19.03.12
            - restore-and-save-cache
            - run: printf "<< parameters.answers >>\na$var\n" | roro rollon
            - run: echo 'success'
    test-rubies:
        executor:
            name: ruby
            version: <<parameters.version>>
        parameters:
            version:
                default: "3.0"
                description: version tag
                type: string
        steps:
            - checkout
            - run: gem install bundler
            - run: bundle
            - run: bundle exec rake test
version: 2.1
workflows:
    gem-release:
        jobs:
            - build
            - release:
                requires:
                    - build
    test-adventures:
        jobs:
            - test-rollon:
                matrix:
                    parameters:
                        answers:
                            - 1\n1
                            - 2\n1
                            - 2\n2
                            - 2\n3
                            - 3\n1\n1\n1
                            - 3\n1\n1\n2
                            - 3\n1\n2\n1
                            - 3\n1\n2\n2
                            - 3\n2\n2\n1
                            - 3\n2\n2\n2
                            - 3\n2\n1\n2\n1\n1
                            - 3\n2\n1\n2\n1\n2
                            - 3\n2\n1\n2\n2\n1
                            - 3\n2\n1\n2\n2\n2
                            - 3\n2\n1\n1\n1\n1\n1
                            - 3\n2\n1\n1\n1\n1\n2
                            - 3\n2\n1\n1\n1\n2\n1
                            - 3\n2\n1\n1\n1\n2\n2
                            - 3\n2\n1\n1\n2\n1\n1
                            - 3\n2\n1\n1\n2\n1\n2
                            - 3\n2\n1\n1\n2\n2\n1
                            - 3\n2\n1\n1\n2\n2\n2
                            - 4\n1
                            - 4\n2
                            - 5\n2
                            - 5\n3
                            - 5\n1\n1\n1\n1
                        os:
                            - linux
    test-matrix-rollon:
        jobs:
            - test-rollon:
                matrix:
                    parameters:
                        answers:
                            - 1\n1
                            - 2\n1
                            - 2\n2
                            - 2\n3
                            - 3\n1\n1\n1
                            - 3\n1\n1\n2
                            - 3\n1\n2\n1
                            - 3\n1\n2\n2
                            - 3\n2\n2\n1
                            - 3\n2\n2\n2
                            - 3\n2\n1\n2\n1\n1
                            - 3\n2\n1\n2\n1\n2
                            - 3\n2\n1\n2\n2\n1
                            - 3\n2\n1\n2\n2\n2
                            - 3\n2\n1\n1\n1\n1\n1
                            - 3\n2\n1\n1\n1\n1\n2
                            - 3\n2\n1\n1\n1\n2\n1
                            - 3\n2\n1\n1\n1\n2\n2
                            - 3\n2\n1\n1\n2\n1\n1
                            - 3\n2\n1\n1\n2\n1\n2
                            - 3\n2\n1\n1\n2\n2\n1
                            - 3\n2\n1\n1\n2\n2\n2
                            - 4\n1
                            - 4\n2
                            - 5\n2
                            - 5\n3
                            - 5\n1\n1\n1\n1
                        os:
                            - linux
    test-matrix-rubies:
        jobs:
            - test-rubies:
                filters:
                    branches:
                        only: main
                matrix:
                    parameters:
                        version:
                            - "2.5"
                            - "2.6"
                            - "2.7"
                            - "3.0"
    test-rubies:
        jobs:
            - test-rubies:
                filters:
                    branches:
                        only: main
                matrix:
                    parameters:
                        version:
                            - "2.5"
                            - "2.6"
                            - "2.7"
                            - "3.0"


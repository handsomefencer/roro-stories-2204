preface: A dynamic, open source programming language with a focus on simplicity and productivity. It has an elegant
  syntax that is natural to read and easy to write.

env:
  base:
    app_name:
      name: Name for your app
      value: unstoppable_app
    DATABASE_NAME:
      name: Database name
      value: postgres
    DATABASE_PASSWORD:
      name: Database password
      value: postgres
    DATABASE_USERNAME:
      name: Database username
      value: postgres
    DATABASE_HOST:
      name: Database host
      value: database
    POSTGRES_NAME:
      name: Database name
      value: ${DATABASE_NAME}
    POSTGRES_PASSWORD:
      name: Database password
      value: ${DATABASE_PASSWORD}
    POSTGRES_USERNAME:
      name: Database username
      value: ${DATABASE_USERNAME}
    POSTGRES_HOST:
      name: Database host
      value: ${DATABASE_HOST}

actions:
  - directory 'stage_one', '.', @env
  - append_to_file './.gitignore', partial('ignores')
  - insert_into_file 'Dockerfile', partial('packages'), after: 'builder'
  - run 'DOCKER_BUILDKIT=1 docker build --file Dockerfile --no-cache --output . .'
  - directory 'stage_two', '.', @env
  - insert_into_file 'Dockerfile', partial('packages'), after: '-alpine'
  - run "chmod u+x 'entrypoints/docker-entrypoint.sh'"

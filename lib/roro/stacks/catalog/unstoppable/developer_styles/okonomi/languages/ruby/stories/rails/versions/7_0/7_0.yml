preface: some string

depends_on:
  - git
env:
  base:
    git_config_user_name:
      name: The name you'd like associated with git activities
      value: Jane Doe
    git_config_user_email:
      name: The email address you'd like associated with git activities
      value: jane.doe@example.com
    rails_version:
      name: Ruby on Rails minor version
      value: 7.0.0.alpha2
        - directory 'stage_one', '.', @env
    DATABASE_NAME:
      name: Database name
      value: postgres
    DATABASE_PASSWORD:
      name: Database password
      value: postgres
    DATABASE_USERNAME:
      name: Database username
      value: postgres
    DATABASE_HOST:
      name: Database host
      value: database
    POSTGRES_NAME:
      name: Database name
      value: ${DATABASE_NAME}
    POSTGRES_PASSWORD:
      name: Database password
      value: ${DATABASE_PASSWORD}
    POSTGRES_USERNAME:
      name: Database username
      value: ${DATABASE_USERNAME}
    POSTGRES_HOST:
      name: Database host
      value: ${DATABASE_HOST}

actions:
  - directory 'stage_one', '.', @env
  - run 'sudo chown -R $USER:$USER .'
  - chmod 'entrypoints/docker-entrypoint.sh', 0755
  - chmod 'entrypoints/sidekiq-entrypoint.sh', 0755
  - insert_into_file 'Gemfile', "gem 'sidekiq', '~>6.0.0'", :before => "\ngroup :development, :test do"
  - |
    generator = Roro::CLI.new
    generator.generate_mise
    generator.generate_containers 'app', 'database', 'redis', 'sidekiq'
    generator.generate_environments @env
    generator.generate_keys

  - run "sudo docker-compose build"
  - run "sudo chown -R $USER:$USER ."
  - run "sudo docker-compose run app rake db:create"
  - run "sudo docker-compose up -d"



defaults: &defaults
  working_directory: /tmp

version: 2

jobs:

  build:
    machine: true
    steps:
      - checkout
      - run: gem install roro
      - run: docker build --build-arg RUBY_IMAGE=ruby:2.5-alpine .
      - run: docker-compose run test 
      - run: roro expose circleci
      - run: echo 'source roro/containers/gem/ci.env' >> $BASH_ENV
      - run: gem install gem-release
      - run: gem release

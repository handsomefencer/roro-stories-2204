workflows:
  version: 2

  build-and-test:
    jobs:
      - build
      filters:
        branches:
          only: master

  build-and-push:
    jobs:
      - build
      - test:
          filters:
            branches:
              only: release
      - push:
          filters:
            branches:
              only: release
      - staging-deploy:
          filters:
            branches:
              only: staging
      - production-deploy:
          filters:
            branches:
              only: release
